<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/project/public

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/project/public>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/labs1>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/labs2>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/labs3>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/labs4>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/labs5>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/labs6>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    <Directory /var/www/html/labs7>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex api.php index.php index.html
    </Directory>

    Alias /labs1 /var/www/html/labs1
    Alias /labs2 /var/www/html/labs2
    Alias /labs3 /var/www/html/labs3
    Alias /labs4 /var/www/html/labs4
    Alias /labs5 /var/www/html/labs5
    Alias /labs6 /var/www/html/labs6
    Alias /labs7 /var/www/html/labs7

    # MIME типы для статических файлов
    AddType audio/mpeg .mp3
    AddType audio/mp4 .m4a
    AddType audio/ogg .ogg
    AddType audio/wav .wav

    RewriteEngine On

    # Пропускаем labs - они обрабатываются через Alias (ПЕРВЫМ!)
    RewriteCond %{REQUEST_URI} ^/labs[0-9]+/
    RewriteRule ^ - [L]

    # Пропускаем физические файлы (включая статические ресурсы в DocumentRoot)
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^ - [L]
    
    # Пропускаем директории
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # Все остальное перенаправляем на index.php проекта
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ /project/public/index.php [QSA,L]

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
